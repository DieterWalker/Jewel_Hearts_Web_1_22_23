var products = [
    // Earring
    {
        nameProduct: "Balenciaga Gold Loop Heart Earrings",
        id: 1,
        price: 1500000,
        description: "description",
        category: "Earring",
        brand: "Harry Winston",
        image: "Earring_01.jpg",
    },
    {
        nameProduct: "Blue Drop Earrings",
        id: 2,
        price: 2400000,
        description: "description",
        category: "Earring",
        brand: "THAYA",
        image: "Earring_02.jpg ",
    },
    {
        nameProduct: "Bridal Drop Earrings",
        id: 3,
        price: 2000000,
        description: "description",
        category: "Earring",
        brand: "LEKANI",
        image: "Earring_03.jpg ",
    },
    {
        nameProduct: "Floral Diamond Stud Earrings",
        id: 4,
        price: 3650000,
        description: "description",
        category: "Earring",
        brand: "Harry Winston",
        image: "Earring_04.jpg ",
    },
    {
        nameProduct: "Memoir Gold Plated Basket Earring",
        id: 5,
        price: 2400000,
        description: "description",
        category: "Earring",
        brand: "Harry Winston",
        image: "Earring_05.jpg ",
    },
    {
        nameProduct: "Gold Thick Hoop Earring",
        id: 6,
        price: 1700000,
        description: "description",
        category: "Earring",
        brand: "Graff",
        image: "Earring_06.jpeg ",
    },
    {
        nameProduct: "Gold Plated Small Earrings",
        id: 7,
        price: 1900000,
        description: "description",
        category: "Earring",
        brand: "Chopard",
        image: "Earring_07.jpg ",
    },
    {
        nameProduct: "Olive Leaf Earrings",
        id: 8,
        price: 1400000,
        description: "description",
        category: "Earring",
        brand: "Tiffany & Co",
        image: "Earring_08.jpg ",
    },
    {
        nameProduct: "Swarovski Qcean Blue Heart Earring",
        id: 9,
        price: 3000000,
        description: "description",
        category: "Earring",
        brand: "LEKANI",
        image: "Earring_09.jpg ",
    },
    {
        nameProduct: "Small Ball Stud Earrings",
        id: 10,
        price: 1600000,
        description: "description",
        category: "Earring",
        brand: "David Yurman",
        image: "Earring_10.jpeg ",
    },
    {
        nameProduct: "Sitashi Gold with Cubic Zirconia Drop Earrings",
        id: 11,
        price: 2600000,
        description: "description",
        category: "Earring",
        brand: "Bvlgari",
        image: "Earring_11.jpg ",
    },
    // Necklace
    {
        nameProduct: "Aurora Pendant Halo Crystal Necklace",
        id: 12,
        price: 3000000,
        description: "description",
        category: "Necklace",
        brand: "LEKANI",
        image: "Necklace_01.jpg",
    },
    {
        nameProduct: "Iconic Swan Necklace",
        id: 13,
        price: 4500000,
        description: "description",
        category: "Necklace",
        brand: "Chopard",
        image: "Necklace_02.jpg",
    },
    {
        nameProduct: "Jewelry Crescent Pendant Moon Necklace",
        id: 14,
        price: 3700000,
        description: "description",
        category: "Necklace",
        brand: "LEKANI",
        image: "Necklace_03.jpg",
    },
    {
        nameProduct: "Platinum Natural Diamond Solitaire Pendant Necklace",
        id: 15,
        price: 4600000,
        description: "description",
        category: "Necklace",
        brand: "THAYA",
        image: "Necklace_04.jpg",
    },
    {
        nameProduct: "Double Layer Choker Necklance",
        id: 16,
        price: 3100000,
        description: "description",
        category: "Necklace",
        brand: "Chopard",
        image: "Necklace_05.jpg",
    },
    {
        nameProduct: "Sliver Butterfly Pendant Chain Necklace",
        id: 17,
        price: 2800000,
        description: "description",
        category: "Necklace",
        brand: "Buccellati",
        image: "Necklace_06.jpg",
    },
    {
        nameProduct: "Midsummer Night's Dream Design Necklace",
        id: 18,
        price: 4200000,
        description: "description",
        category: "Necklace",
        brand: "THAYA",
        image: "Necklace_07.jpg",
    },
    {
        nameProduct: "Sterling Sliver Infinity Pendant Chain Necklace",
        id: 19,
        price: 3700000,
        description: "description",
        category: "Necklace",
        brand: "Graff",
        image: "Necklace_08.jpg",
    },
    {
        nameProduct: "White Gold Heart Shaped Sky-Blue Topaz and Diamond Necklace",
        id: 20,
        price: 4400000,
        description: "description",
        category: "Necklace",
        brand: "Tiffany & Co",
        image: "Necklace_09.jpg",
    },
    //Ring
    {
        nameProduct: "Diamond Engagement Ring",
        id: 21,
        price: 1150000,
        description: "description",
        category: "Ring",
        brand: "Tiffany & Co",
        image: "Ring_01.jpg",
    },
    {
        nameProduct: "Goddesslili Black Diamond Ring",
        id: 22,
        price: 2950000,
        description: "description",
        category: "Ring",
        brand: "LEKANI",
        image: "Ring_02.jpg",
    },
    {
        nameProduct: "Ziron Diamond Ring",
        id: 23,
        price: 2450000,
        description: "description",
        category: "Ring",
        brand: "THAYA",
        image: "Ring_03.png",
    },
    {
        nameProduct: "Swarovski Women's Ring Stainless Steel Crystal",
        id: 24,
        price: 1750000,
        description: "description",
        category: "Ring",
        brand: "Graff",
        image: "Ring_06.jpg",
    },
    {
        nameProduct: "Simple Heart Ring",
        id: 25,
        price: 1600000,
        description: "description",
        category: "Ring",
        brand: "Chopard",
        image: "Ring_07.jpg",
    },

    //Bracelet
    {
        nameProduct: "Stain less Steel Bracelets",
        id: 26,
        price: 2400000,
        description: "description",
        category: "Bracelet",
        brand: "LEKANI",
        image: "Bracelet_01.jpg",
    },
    {
        nameProduct: "Stainless Steel Love Heart Charm Bracelets",
        id: 27,
        price: 2200000,
        description: "description",
        category: "Bracelet",
        brand: "Chopard",
        image: "Bracelet_02.jpg",
    },
    {
        nameProduct: "Luxury Mermaid Tail Crystal Beaded Bracelet",
        id: 28,
        price: 2150000,
        description: "description",
        category: "Bracelet",
        brand: "THAYA",
        image: "Bracelet_03.jpg",
    },
    {
        nameProduct: "Luxury Crystal Bracelet",
        id: 29,
        price: 1150000,
        description: "description",
        category: "Bracelet",
        brand: "Bvlgari",
        image: "Bracelet_04.jpg",
    },
    {
        nameProduct: "Mahi Crystal Black White Elephant Bracelet",
        id: 30,
        price: 2250000,
        description: "description",
        category: "Bracelet",
        brand: "Chopard",
        image: "Bracelet_05.jpg",
    },
    {
        nameProduct: "Sterling Sliver Link Bracelet",
        id: 31,
        price: 1550000,
        description: "description",
        category: "Bracelet",
        brand: "Gucci",
        image: "Bracelet_06.jpg",
    },
    {
        nameProduct: "Gold Charm Bracelet",
        id: 32,
        price: 1700000,
        description: "description",
        category: "Bracelet",
        brand: "Tiffany & Co",
        image: "Bracelet_07.png",
    },
    {
        nameProduct: "Crystal Lady Charm Bracelet",
        id: 33,
        price: 1650000,
        description: "description",
        category: "Bracelet",
        brand: "THAYA",
        image: "Bracelet_08.jpg",
    },
    {
        nameProduct: "Copper Crytal Bangle Gemstone Bracelet",
        id: 34,
        price: 1950000,
        description: "description",
        category: "Bracelet",
        brand: "Chopard",
        image: "Bracelet_09.jpg",
    },
]

// Kiểm tra input 
function validateInput() {
    let formElement = document.querySelector(".themsp")
    let inputElement = formElement.querySelectorAll(".form-input")
    for (let i = 0; i < inputElement.length; i++) { //Duyệt từng phần tử input
        if (inputElement[i].value == "") { // Kiểm tra đầu vào rỗng
            // Gán text cho mọi input
            inputElement[i].parentElement.querySelector(".error-message").innerText = `Please enter your ${inputElement[i].id}`
        } else {
            inputElement[i].parentElement.querySelector(".error-message").innerText = ""
        }
    }
}

//Thêm
function Add() {
    validateInput();
    let formElement = document.querySelector(".themsp")
    let errorElement = formElement.querySelectorAll(".error-message")
    let arrErrorElement = []
    for (let i = 0; i < errorElement.length; i++) {
        arrErrorElement.push(errorElement[i].innerText)
    }
    // Hàm every kiểm tra  tất cả các input nếu có 1 input sai -> false
    // Nếu hàm trả về giá trị value === rỗng -> true , nguoc lai
    let checkErrorElement = arrErrorElement.every(value => value === "") 
    if (checkErrorElement) { //true
        //Save data
        let id = document.getElementById("id").value
        let name = document.getElementById("name").value
        let img = document.getElementById("upload").files[0].name
        let brand = document.getElementById("brand").value
        let price = document.getElementById("price").value
        // kiem tra trong localStorage co key la list-product hay chua (toan tu 3 ngoi)
        // Neu co lay ra , giai ma them tiep vao
        // Neu chua them mot mang moi
        //listProduct = []
        let listProduct = localStorage.getItem("list-product") ? JSON.parse(localStorage.getItem("list-product")) : []
        listProduct.push({
            id: id,
            nameProduct: name,
            image: img,
            brand: brand,
            price: price
        })

        //Đẩy dữ liệu vào  localStorage với key = "list-product"
        // JSON.stringify(listProduct) có tác dụng mã hóa
        localStorage.setItem("list-product", JSON.stringify(listProduct))
        console.log(listProduct)
        renderProduct()
        resetInput()
    }
}

//Đẩy sản phẩm
function renderProduct() {
    //Kiểm tra  localStorage
    let listProduct = localStorage.getItem("list-product") ? JSON.parse(localStorage.getItem("list-product")) : []

    //Tạo biến để chứa table
    let product = `
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Img</th>
            <th>Brand</th>
            <th>Price</th>
            <th>Action</th>
        </tr>`

    listProduct.map((value, index) => {
        product += `<tr>
                        <td>${index + 1}</td>
                        <td>${value.nameProduct}</td>
                        <td> <img src="./img/${value.image}" alt=""></td>
                        <td>${value.brand}</td>
                        <td>${value.price} VND</td>
                        <td>
                        <input class="action" type="button" name="btn-edit" id="editsp" value="Edit" onClick="Edit(${index})" >
                        <input class="action" type="button" name="btn-delete" id="deletesp" value="Delete" onClick="Delete(${index})" >
                        </td>
                    </tr>` 
    })
    document.getElementById("table-sp").innerHTML = product
}
renderProduct();

// Hàm tạo ẩn hiện cho form thêm sản phẩm 
function formthemsp(){
    document.getElementById("t-themsp").style.display = "block";
}

function dongthemsp(){
    document.getElementById("t-themsp").style.display = "none";
}

function mothemsp(){
    document.getElementById("t-themsp").style.display = "block"
}

// Reset input
function resetInput() {
    document.getElementById("id").value = ""
    document.getElementById("name").value = ""
    document.getElementById("upload").files[0].name = ""
    document.getElementById("brand").value = ""
    document.getElementById("price").value = ""
}

// Sửa
function Edit(index) {
    let listProduct = localStorage.getItem("list-product") ? JSON.parse(localStorage.getItem("list-product")) : []
    mothemsp();
    // console.log(index)
    //Lấy dữ liệu từ localStorage cho hiển thị trên form
    document.getElementById("name").value = listProduct[index].nameProduct
    document.getElementById("id").value = index
    document.getElementById("upload").files[index] = listProduct[index].image
    document.getElementById("brand").value = listProduct[index].brand
    document.getElementById("price").value = listProduct[index].price
    document.getElementById("receiveindex").value = index


    document.getElementById("save").style.display = "none" // Ẩn nút thêm
    document.getElementById("update").style.display = "inline-block" //Hiện nút update

}

// Hàm thay đổi dữ liệu sản phẩm 
function changeProduct() {
    let listProduct = localStorage.getItem("list-product") ? JSON.parse(localStorage.getItem("list-product")) : []
    let receiveindex = document.getElementById("receiveindex").value

    //Cập nhật dữ liệu
    listProduct[receiveindex]={
        nameProduct: document.getElementById("name").value,
        image: document.getElementById("upload").files[0].name,
        brand: document.getElementById("brand").value,
        price: document.getElementById("price").value     
    }

     // Đẩy dữ liệu vào  localStorage
     localStorage.setItem("list-product",JSON.stringify(listProduct))
     document.getElementById("save").style.display = "inline-block" 
     document.getElementById("update").style.display = "none" 
     resetInput()
     renderProduct()

}

// Xóa
function Delete(index) {
    // console.log(index)
    let listProduct = localStorage.getItem("list-product") ? JSON.parse(localStorage.getItem("list-product")) : []
    let choice = confirm("Bạn có chắc chắn muốn xóa ?")
        if(choice == true){
            listProduct.splice(index,1) // Với index là giá trị lưu trữ hay và bắt đầu , 1 là số phần tử bị xóa tính từ index
            localStorage.setItem("list-product",JSON.stringify(listProduct))
            renderProduct()
        }else{
            alert("Đã hủy xóa sản phẩm !");
        }
}

// Hiển thị hình ảnh trước khi thêm
        function ImagesFileAsURL() {
            var fileSelected = document.getElementById('upload').files
            if(fileSelected.length > 0){
                var fileToLoad = fileSelected[0];
                var fileReader = new FileReader();
                fileReader.onload = function(fileLoaderEvent){
                    var srcData = fileLoaderEvent.target.result;
                    var newImage = document.createElement('img');
                    newImage.src = srcData;
                    document.getElementById('displayImg').innerHTML = newImage.outerHTML;
                }
                fileReader.readAsDataURL(fileToLoad);
            }
        }

// Hiển thị trang cần sử dụng
function showcontent() {
    var url = window.location.href;
    var id = url.split('?');
    idd = id[1];
    switch(idd)
    {
        case "sp":
        {
            document.getElementById("container").innerHTML=`<div id="left-menu">
            <div id="t-themsp">
                <!-- Tiêu đề form thêm sản phẩm  -->
                <div class="header-tsp" style="position: relative;">
                    <h2>Thêm sản phẩm</h2>
                    <a class="" onclick="dongthemsp()" style="position:absolute; right: 10px; top: 5px; font-size: 20px; cursor: pointer;" value="themsanpham">
                        <i class="fas fa-times"></i>
                    </a>
                </div>
                <hr>
                <!-- Form thêm sản phẩm  -->
                <div class="form-themsp">
                    <form action="" class="themsp">
                        <div class="item-themsp">
                            <p>ID :</p>
                            <input type="text" id="id" class="form-input" >
                            <div class="error-message"></div>
                        </div><br>
                        <div class="item-themsp">
                            <p>Name :</p>
                            <input type="text" id="name" class="form-input" > 
                            <div class="error-message"></div>
                        </div><br>
                        <div class="item-themsp">
                            <p>Img :</p>
                            <input type="file" name="upload" id="upload" class="form-input" onchange="ImagesFileAsURL()">
                            <div class="error-message"></div>
                        </div><br>
                        <div class="border-img">
                            <!-- Nơi chứa hình ảnh , hình ảnh sẽ hiện vào trong thẻ div này -->
                            <div id="displayImg">
                            </div><br>
                        </div><br>
                        <div class="item-themsp">
                            <p>Brand :</p>
                            <input type="text" id="brand" class="form-input" >
                            <div class="error-message"></div>
                        </div><br>
                        <div class="item-themsp">
                            <p>Price :</p>
                            <input type="text" id="price" class="form-input" >
                            <div class="error-message"></div>
                        </div><br> 
                        <!-- Form ẩn để hứng id truyền lên form chính -->
                        <div class="item-receive-index">
                            <input type="hidden" id="receiveindex" >
                        </div><br> 
                        <!-- Button của form thêm sản phẩm -->
                        <div class="themsp-btn" style="position: relative;">
                            <input id="save" type="button" onclick="Add()" value="Thêm" >
                            <input id="update" style="display: none;" type="button" onclick="changeProduct(this)" value="Sửa" >
                        </div>
                    </form>
                </div>                    
            </div>
            <!-- Tiêu đề trang quản lý sản phẩm  -->
            <h2>Danh sách sản phẩm</h2><br>
            <div class="menu-action">
                <input type="button" name="btn-add" id="add" value="Thêm sản phẩm" onclick="mothemsp()" >
            </div><br>
            <br><hr>
            <!-- Bảng chứa danh sách sản phẩm  -->
            <table id="table-sp" style="border: 1;" cellpadding="10" cellspace="0">
            </table>`;
            break;     
        }
        case "dh":
        {
            document.getElementById("container").innerHTML=`<div class="ql-donhang">
            <h2>Quản lý đơn hàng</h2>
            <table id="table-qldh" style="border: 1;" cellpadding="10" cellspace="0">
                <tr>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Total Order</th>
                    <th>Status</th>
                </tr>
                <tr>
                    <td>10/31/2022</td>
                    <td>Tommy Shelby</td>
                    <td>1000000000</td>
                    <td>Xu ly</td>
                </tr>
            </table>
        </div>`;
            break;     
        }
        case "usr":
        {
            document.getElementById("container").innerHTML=`<div class="ql-user">
            <h2>Quản lý khách hàng  </h2>
            <table id="table-qlur" style="border: 1;" cellpadding="10" cellspace="0">
                <tr>
                    <th>Name</th>
                    <th>UserName</th>
                    <th>Date</th>
                    <th>Action</th>
                </tr>
                <tr>
                    <td>Tommy Shelby</td>
                    <td>Tommy_Shelby</td>
                    <td>10/31/2022</td>
                    <td>Xóa</td>
                </tr>
            </table>
        </div>`;

            break;     
        }
        case "tk":
        {
            document.getElementById("container").innerHTML="<div><p>Thống kê</p><div>";
            break;     
        }
        default:
        {
            document.getElementById("container").innerHTML="";
            break;
        }
    }

}

window.onload = function (){
    showcontent();
    renderProduct()
}